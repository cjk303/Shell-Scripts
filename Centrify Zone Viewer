# Get all zones once
$allZones = Get-CdmZone

$results = foreach ($computer in $computers) {
    # Match zone using ZoneGuid
    $zone = $allZones | Where-Object { $_.Guid -eq $computer.ZoneGuid }

    # Extract domain name from DN
    $dn = $computer.DistinguishedName
    if ($dn -match "DC=") {
        $domainParts = ($dn -split ",") | Where-Object { $_ -like "DC=*" }
        $domainName = ($domainParts -replace "DC=") -join "."
    } else {
        $domainName = "Unknown"
    }

    [PSCustomObject]@{
        ComputerName = $computer.Name
        Domain       = $domainName
        Zone         = $zone.Name
    }
}
