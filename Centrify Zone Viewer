# Import the Centrify PowerShell module
Import-Module Centrify.DirectControl.PowerShell

# Get all managed computers from Centrify
$computers = Get-CdmManagedComputer

# Prepare results
$results = foreach ($computer in $computers) {
    # Get the zone object using the Zone GUID
    $zone = Get-CdmZone -Guid $computer.ZoneGuid

    # Extract domain name from DN
    $dn = $computer.DistinguishedName
    if ($dn -match "DC=") {
        $domainParts = ($dn -split ",") | Where-Object { $_ -like "DC=*" }
        $domainName = ($domainParts -replace "DC=") -join "."
    } else {
        $domainName = "Unknown"
    }

    [PSCustomObject]@{
        ComputerName = $computer.Name
        Domain       = $domainName
        Zone         = $zone.Name
    }
}

# Output as table
$results | Format-Table -AutoSize

# Optionally export to CSV
#$results | Export-Csv -Path "CentrifyComputers.csv" -NoTypeInformation
